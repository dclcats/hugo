<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>git reset --hard 操作后的数据恢复 | 灿灿的博客网</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="在进行正文之前先简单介绍下git reset 命令"><meta name=generator content="Hugo 0.82.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/hugo/ananke/dist/main.css_5c99d70a7725bacd4c701e995b969fea.css><link rel="shortcut icon" href=/hugo/images/ico/favicon.jpg type=image/x-icon><meta property="og:title" content="git reset --hard 操作后的数据恢复"><meta property="og:description" content="在进行正文之前先简单介绍下git reset 命令"><meta property="og:type" content="article"><meta property="og:url" content="https://dclcats.github.io/hugo/Articles/git/git-reset.html"><meta property="article:section" content="Articles"><meta property="article:published_time" content="2014-07-11T10:54:24+02:00"><meta property="article:modified_time" content="2014-07-11T10:54:24+02:00"><meta itemprop=name content="git reset --hard 操作后的数据恢复"><meta itemprop=description content="在进行正文之前先简单介绍下git reset 命令"><meta itemprop=datePublished content="2014-07-11T10:54:24+02:00"><meta itemprop=dateModified content="2014-07-11T10:54:24+02:00"><meta itemprop=wordCount content="64"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="git reset --hard 操作后的数据恢复"><meta name=twitter:description content="在进行正文之前先简单介绍下git reset 命令"></head><body class="ma0 avenir bg-near-white"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/hugo/ class="f3 fw2 hover-white no-underline white-90 dib">灿灿的博客网</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/hugo/About.html title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/hugo/Articles.html title="Articles page">Articles</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/hugo/Articles/react.html title="每天一点react page">每天一点react</a></li></ul></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">ARTICLES</aside><div id=sharing class=mt3><a href="https://www.facebook.com/sharer.php?u=https://dclcats.github.io/hugo/Articles/git/git-reset.html" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a href="https://twitter.com/share?url=https://dclcats.github.io/hugo/Articles/git/git-reset.html&text=git%20reset%20--hard%20%e6%93%8d%e4%bd%9c%e5%90%8e%e7%9a%84%e6%95%b0%e6%8d%ae%e6%81%a2%e5%a4%8d" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://dclcats.github.io/hugo/Articles/git/git-reset.html&title=git%20reset%20--hard%20%e6%93%8d%e4%bd%9c%e5%90%8e%e7%9a%84%e6%95%b0%e6%8d%ae%e6%81%a2%e5%a4%8d" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 athelas mt3 mb1">git reset --hard 操作后的数据恢复</h1><p class=tracked>By <strong>Chris-dc</strong></p><time class="f6 mv4 dib tracked" datetime=2014-07-11T10:54:24+02:00>July 11, 2014</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>在进行正文之前先简单介绍下<code>git reset</code> 命令</p><h3 id=git-reset>git reset</h3><p><code>git reset</code> 命令用于改变当前的仓库状态，简单的场景用例：假设一次修改了两个文件，然而需要对这两个文件分别进行两次提交，在进行缓存操作时（<code>git add</code>），不小心将两个文件都进行了缓存，此时我们需要对其中一个文件取消缓存，此时就需要<code>git reset</code> 操作来实现，如下图
<img src=https://user-images.githubusercontent.com/26424129/39693980-53792fbe-5218-11e8-9d88-7aa3a7ee5443.png alt=image>
然后，对<code>b.txt</code>进行<code>commit</code>操作，然后再对<code>a.txt</code>进行<code>add & commit</code>操作</p><p>对于<code>git reset</code>命令添加了**&ndash;hard** 参数后会怎样呢，在<a href=https://git-scm.com/docs/git-reset>git官网的reference上</a> 有如下一段话</p><p>也就是说，添加<code>--hard</code>参数后，会回到上次<code>commit</code>的状态，也就是说从上次<code>commit</code>之后的的修改都将被重置，换句话说这些数据都丢失了，所以要谨慎操作哦。</p><p><img src=https://user-images.githubusercontent.com/26424129/39694690-c4e15864-521a-11e8-8be5-75c2a5f91780.png alt=image></p><p>前置知识就到这里了，开始今天的重点。</p><p>当我们进行了<code>git reset --hard</code>操作进行了版本回退，现在我们又需要之前的修改信息，也就是说我们需要版本回退之前的文件信息，此时我分了三种情况</p><ol><li>之前的修改进行了 <code>commit</code> 提交，也就是说我们回退前的修改（曾经）存在于版本里;</li><li>之前的修改未进行<code>commit</code>提交，但是进行了 <code>git add</code> 操作；</li><li>之前的修改未进行 <code>commit</code> 提交，也未进行<code>git add</code>操作。</li></ol><p>如果时第一种情况，很简单我们拿到之前修改的<code>commit</code>的哈希值（或者说id），然后执行 <code>git reset --hard [hash]</code>就可以回退到之前修改的状态。
怎么拿<code>hash</code>， 这个好说，可以执行命令<code>git reflog</code>命令，它会显示出你之前的所有操作
像这个</p><p><img src=https://user-images.githubusercontent.com/26424129/39695387-f6a31e58-521c-11e8-8203-5af2c60b1e66.png alt=image></p><p><code>62f039e</code> 就是我的<code>reflog</code>提交的哈希值，对其进行<code>reset</code>即可</p><p>如果是第三种情况，不好意思暂时还没有找回的办法，如果你有欢迎拿出来大家交流</p><p>今天的重点就是第二种情况，毕竟曾经我也以为此情况无解，直到后来这边文章诞生前。</p><p>今天的主角命令 <code>git fsck</code>，这里呢不具体讲解此命令，只是简单描述利用此命令进行文件恢复。</p><p><img src=https://user-images.githubusercontent.com/26424129/39695724-2540e294-521e-11e8-9171-c4596fcdef25.png alt=image></p><p><img src=https://user-images.githubusercontent.com/26424129/39695739-30cf161c-521e-11e8-9124-521a9815ce06.png alt=image></p><p>如图示，我新建了文件<code>c.txt</code>并添加了内容 &lsquo;git fsck&rsquo;，添加到缓存之后进行了<code>reset</code>操作， 此时因为没有进行<code>git commit</code>操作所以没有hash值，可供恢复，这个时候需要进行操作 <code>git fsck --lost-found</code>操作，返回如下结果：</p><p><img src=https://user-images.githubusercontent.com/26424129/39697557-e8e843c2-5223-11e8-88dc-14ae11c22f36.png alt=image></p><p>关于此命令，git官网的解释
<img src=https://user-images.githubusercontent.com/26424129/39697417-76095378-5223-11e8-8453-654d38de8cd9.png alt=image>
根据提示，找到目录'.git/lost-found'，可以看到，</p><p><img src=https://user-images.githubusercontent.com/26424129/39697621-191fa13e-5224-11e8-901a-b9a7f881b396.png alt=image></p><p>我们在‘commit’和‘other’目录下分别看到命令窗口打印出的文件，在‘other‘目录下找出之前遗失的文件
<img src=https://user-images.githubusercontent.com/26424129/39697733-87c3c23c-5224-11e8-8755-443df0853a26.png alt=image>
然后新建&rsquo;c.txt&rsquo;文件，并将文件内容复制过去，结束。</p><p>是不是很麻烦，特别是一次提交的文件多了，一个一个新建（修改）复制过去好烦哦。</p><p>是的很烦，所以保持良好的习惯。永远不要让这种操作降临到自己身上才是正道。（这只是为不可控的意外情况准备的）</p><ul class=pa0></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://dclcats.github.io/hugo/>&copy; 灿灿的博客网 2021</a><div></div></div></footer></body></html>